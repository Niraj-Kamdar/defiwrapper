version: 2.1

orbs:
  node: 'circleci/node@5.0.2'

jobs:
  Base:
    executor:
      name: node/default
    steps:
        - run: yarn install --nonInteractive --frozen-lockfile --prefer-offline
      # - persist_to_workspace:
      #   # Must be an absolute path, or relative path from working_directory. This is a directory on the container which is
      #   # taken to be the root directory of the workspace.
      #   root: workspace
      #   # Must be relative path from root
      #   paths:
      #     - /

  Lint:
    executor:
      name: node/default
    steps:
      # - attach_workspace:
      #   # Must be absolute path or relative path from working_directory
      #   at: /
      - run: yarn lint
      - run: yarn format:check
  Coingecko:
    executor:
      name: node/default
    steps:
      # - attach_workspace:
      #   # Must be absolute path or relative path from working_directory
      #   at: /
      - run: lerna run build --scope @defiwrapper/coingecko
      - run: lerna run test --scope @defiwrapper/coingecko

workflows:
  version: 2
  build-test-and-deploy:
    jobs:
      - Base
      - Lint:
          requires:
            - Base
      - Coingecko:
          requires:
            - Base
